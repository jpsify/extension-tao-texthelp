define("json!taoTextHelp//runner/plugins/tools/textToSpeech/languages.json",function(){return{"ar-WW":{name:"Arabic",language:"ARABIC",code:"ar",locale:"WW",voices:{male:["Tarik"]}},"eu-ES":{name:"Basque",language:"SPANISH",code:"eu",locale:"ES",voices:{female:["Miren"]}},"ca-ES":{name:"Catalan",language:"SPANISH",code:"ca",locale:"ES",voices:{female:["Montserrat"]}},"zh-HK":{name:"Chinese (Cantonese - Hong Kong)",language:"CHINESE",code:"zh",locale:"HK",voices:{female:["Sin-Ji"]}},"zh-CN":{name:"Chinese (Mandarin - Simplified)",language:"MANDARIN",code:"zh",locale:"CN",voices:{female:["Tian-Tian"]}},"zh-TW":{
name:"Chinese (Mandarin - Traditional - Tiawanese)",language:"MANDARIN",code:"zh",locale:"TW",voices:{female:["Mei-Jia"]}},"cs-CZ":{name:"Czech",language:"CZECH",code:"cs",locale:"CZ",voices:{female:["Zuzana"]}},"nl-NL":{name:"Dutch",language:"DUTCH",code:"nl",locale:"NL",voices:{male:["Xander"],female:["Claire"]}},"nl-BE":{name:"Dutch (Belgian and Flemish)",language:"DUTCH",code:"nl",locale:"BE",voices:{female:["Ellen"]}},"en-AU":{name:"English (Australian)",language:"AUSTRALIAN",code:"en",locale:"AU",voices:{male:["Lee"],female:["Karen"]}},"en-IN":{name:"English (India)",language:"ENGLISH",code:"en",locale:"IN",voices:{female:["Veena"]}},"en-IE":{
name:"English (Irish)",language:"ENGLISH",code:"en",locale:"IE",voices:{female:["Moira"]}},"en-SC":{name:"English (Scottish)",language:"ENGLISH",code:"en",locale:"SC",voices:{female:["Fiona"]}},"en-ZA":{name:"English (South African)",language:"ENGLISH",code:"en",locale:"ZA",voices:{female:["Tessa"]}},"en-UK":{name:"English (UK)",language:"ENGLISH_UK",code:"en",locale:"UK",voices:{male:["Daniel"],female:["Serena"]}},"en-US":{name:"English (US)",language:"ENGLISH_US",code:"en",locale:"US",voices:{male:["Tom"],female:["Ava","Allison","Samantha"]}},"fi-FI":{name:"Finnish",language:"FINNISH",code:"fi",locale:"FI",voices:{female:["Satu"]}},"fr-FR":{name:"French",
language:"FRENCH",code:"fr",locale:"FR",voices:{male:["Thomas"],female:["Audrey"]}},"fr-CA":{name:"French (Canadian)",language:"FRENCH_CA",code:"fr",locale:"CA",voices:{female:["Amelie"]}},"de-DE":{name:"German",language:"GERMAN",code:"de",locale:"DE",voices:{male:["Yannick"],female:["Anna","Petra"]}},"el-GR":{name:"Greek",language:"GREEK",code:"el",locale:"GR",voices:{male:["Nikos"],female:["Melina"]}},"hi-IN":{name:"Hindi",language:"HINDI",code:"hi",locale:"IN",voices:{female:["Lekha"]}},"hu-HU":{name:"Hungarian",language:"HUNGARIAN",code:"hu",locale:"HU",voices:{female:["Mariska"]}},"id-ID":{name:"Indonesian (Bahasa)",language:"INDONESIAN",code:"id",
locale:"ID",voices:{female:["Damayanti"]}},"it-IT":{name:"Italian",language:"ITALIAN",code:"it",locale:"IT",voices:{male:["Luca"],female:["Alice","Federica","Paola"]}},"jp-JP":{name:"Japanese",language:"JAPANESE",code:"jp",locale:"JP",voices:{male:["Otoya"],female:["Kyoko"]}},"ko-KR":{name:"Korean",language:"KOREAN",code:"ko",locale:"KR",voices:{female:["Sora"]}},"no-NO":{name:"Norwegian",language:"NORWEGIAN",code:"no",locale:"NO",voices:{male:["Henrik"],female:["Nora"]}},"pl-PL":{name:"Polish",language:"POLISH",code:"pl",locale:"PL",voices:{female:["Ewa","Zosia"]}},"pt-PT":{name:"Portuguese",language:"PORTUGUESE",code:"pt",locale:"PT",voices:{female:[
"Catarina","Joana"]}},"pt-BR":{name:"Portuguese (Brazilian)",language:"PORTUGUESE",code:"pt",locale:"BR",voices:{male:["Felipe"],female:["Luciana"]}},"ro-RO":{name:"Romanian",language:"ROMANIAN",code:"ro",locale:"RO",voices:{female:["Ioana"]}},"ru-RU":{name:"Russian",language:"RUSSIAN",code:"ru",locale:"RU",voices:{male:["Yuri"],female:["Milena"]}},"sk-SK":{name:"Slovakian",language:"SLOVAKIAN",code:"sk",locale:"SK",voices:{female:["Laura"]}},"es-ES":{name:"Spanish",language:"SPANISH",code:"es",locale:"ES",voices:{male:["Jorge"],female:["Monica"]}},"es-CO":{name:"Spanish (Columbian)",language:"SPANISH",code:"es",locale:"CO",voices:{male:["Carlos"],female:[
"Soledad"]}},"gl-ES":{name:"Galician (Spain)",language:"SPANISH",code:"gl",locale:"ES",voices:{female:["Carmela"]}},"es-MX":{name:"Spanish (Mexican)",language:"SPANISH",code:"es",locale:"MX",voices:{male:["Juan"],female:["Paulina"]}},"sv-SE":{name:"Swedish",language:"SWEDISH",code:"sv",locale:"SE",voices:{male:["Oskar"],female:["Alva"]}},"th-TH":{name:"Thai",language:"THAI",code:"th",locale:"TH",voices:{female:["Kanya"]}},"tr-TR":{name:"Turkish",language:"TURKISH",code:"tr",locale:"TR",voices:{male:["Cem"],female:["Yelda"]}}}}),define("json!taoTextHelp//runner/plugins/tools/textToSpeech/crosswalk.json",function(){return{af:"en-US","af-za":"en-US",ar:"ar-WW",
"ar-ae":"ar-WW","ar-bh":"ar-WW","ar-dz":"ar-WW","ar-eg":"ar-WW","ar-iq":"ar-WW","ar-jo":"ar-WW","ar-kw":"ar-WW","ar-lb":"ar-WW","ar-ly":"ar-WW","ar-ma":"ar-WW","ar-om":"ar-WW","ar-qa":"ar-WW","ar-sa":"ar-WW","ar-sy":"ar-WW","ar-tn":"ar-WW","ar-ye":"ar-WW",az:"en-US","az-az":"en-US",be:"ru-RU","be-by":"ru-RU",bg:"en-US","bg-bg":"en-US","bs-ba":"en-US",ca:"ca-ES","ca-es":"ca-ES",cs:"cs-CZ","cs-cz":"cs-CZ",cy:"cy-EN","cy-gb":"cy-EN",da:"en-US","da-dk":"en-US",de:"de-DE","de-at":"de-DE","de-ch":"de-DE","de-de":"de-DE","de-li":"de-DE","de-lu":"de-DE",dv:"en-US","dv-mv":"en-US",el:"el-GR","el-gr":"el-GR",en:"en-US","en-au":"en-AU","en-bz":"en-UK","en-ca":"en-UK",
"en-cb":"en-UK","en-gb":"en-UK","en-ie":"en-UK","en-jm":"en-UK","en-nz":"en-UK","en-ph":"en-UK","en-tt":"en-UK","en-us":"en-US","en-za":"en-ZA","en-zw":"en-ZA",eo:"es-ES",es:"es-ES","es-ar":"es-ES","es-bo":"es-ES","es-cl":"es-ES","es-co":"es-CO","es-cr":"es-ES","es-do":"es-ES","es-ec":"es-ES","es-es":"es-ES","es-gt":"es-ES","es-hn":"es-ES","es-mx":"es-MX","es-ni":"es-ES","es-pa":"es-ES","es-pe":"es-ES","es-pr":"es-ES","es-py":"es-ES","es-sv":"es-ES","es-uy":"es-ES","es-ve":"es-ES",et:"en-US","et-ee":"en-US",eu:"eu-ES","eu-es":"eu-ES",fa:"en-US","fa-ir":"en-US",fi:"fi-FI","fi-fi":"fi-FI",fo:"en-US","fo-fo":"en-US",fr:"fr-FR","fr-be":"fr-FR","fr-ca":"fr-CA",
"fr-ch":"fr-FR","fr-fr":"fr-FR","fr-lu":"fr-FR","fr-mc":"fr-FR",gl:"gl-ES","gl-es":"gl-ES",gu:"en-US","gu-in":"en-US",he:"en-US","he-il":"en-US",hi:"en-US","hi-in":"en-US",hr:"en-US","hr-ba":"en-US","hr-hr":"en-US",hu:"hu-HU","hu-hu":"hu-HU",hy:"en-US","hy-am":"en-US",id:"id-ID","id-id":"id-ID",is:"en-US","is-is":"en-US",it:"it-IT","it-ch":"it-IT","it-it":"it-IT",ja:"jp-JP","ja-jp":"jp-JP",ka:"en-US","ka-ge":"en-US",kk:"en-US","kk-kz":"en-US",kn:"en-US","kn-in":"en-US",ko:"ko-KR","ko-kr":"ko-KR",kok:"en-US","kok-in":"en-US",ky:"en-US","ky-kg":"en-US",lt:"en-US","lt-lt":"en-US",lv:"en-US","lv-lv":"en-US",mi:"en-US","mi-nz":"en-US",mk:"en-US","mk-mk":"en-US",
mn:"en-US","mn-mn":"en-US",mr:"en-US","mr-in":"en-US",ms:"en-US","ms-bn":"en-US","ms-my":"en-US",mt:"en-US","mt-mt":"en-US",nb:"no-NO",no:"no-NO","nb-no":"no-NO",nl:"nl-NL","nl-be":"nl-BE","nl-nl":"nl-NL","nn-no":"nl-NL",ns:"en-US","ns-za":"en-US",pa:"en-US","pa-in":"en-US",pl:"pl-PL","pl-pl":"pl-PL",ps:"en-US","ps-ar":"en-US",pt:"pt-PT","pt-br":"pt-BR","pt-pt":"pt-PT",qu:"en-US","qu-bo":"en-US","qu-ec":"en-US","qu-pe":"en-US",ro:"ro-RO","ro-ro":"ro-RO",ru:"ru-RU","ru-ru":"ru-RU",sa:"en-US","sa-in":"en-US",se:"sv-SE","se-fi":"fi-FI","se-no":"no-NO","se-se":"sv-SE",sk:"sk-SK","sk-sk":"sk-SK",sl:"en-US","sl-si":"en-US",sq:"en-US","sq-al":"en-US",
"sr-ba":"en-US","sr-sp":"en-US",sv:"sv-SE","sv-fi":"fi-FI","sv-se":"sv-SE",sw:"en-US","sw-ke":"en-US",syr:"en-US","syr-sy":"en-US",ta:"en-US","ta-in":"en-US",te:"en-US","te-in":"en-US",th:"th-TH","th-th":"th-TH",tl:"en-US","tl-ph":"en-US",tn:"en-US","tn-za":"en-US",tr:"tr-TR","tr-tr":"tr-TR",tt:"en-US","tt-ru":"ru-RU",ts:"en-US",uk:"ru-RU","uk-ua":"ru-RU",ur:"en-US","ur-pk":"en-US",uz:"en-US","uz-uz":"en-US",vi:"en-US","vi-vn":"en-US",xh:"en-US","xh-za":"en-US",zh:"zh-CN","zh-cn":"zh-CN","zh-hk":"zh-HK","zh-mo":"zh-CN","zh-sg":"zh-CN","zh-tw":"zh-TW",zu:"en-US","zu-za":"en-US"}}),define("tpl!taoTextHelp/runner/plugins/tools/textToSpeech/textToSpeech",[
"handlebars"],function(hb){return hb.template(function(stack1,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],data=data||{};var helper,options,buffer="",helperMissing=(helpers=this.merge(helpers,stack1.helpers)).helperMissing,escapeExpression=this.escapeExpression;return buffer+='<div class="text-to-speech hidden">\n    <div class="action click-to-speak" data-control="clickToSpeak" title="'+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"Click to speak",options):helperMissing.call(depth0,"__","Click to speak",options))
)+'"><span class="icon-click-to-speak"></span></div>\n    <div class="action play" data-control="play" title="'+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"Play",options):helperMissing.call(depth0,"__","Play",options)))+'"><span class="icon-play"></span></div>\n    <div class="action pause" data-control="pause" title="'+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"Pause",options):helperMissing.call(depth0,"__","Pause",options))
)+'"><span class="icon-pause"></span></div>\n    <div class="action stop" data-control="stop" title="'+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"Stop",options):helperMissing.call(depth0,"__","Stop",options)))+'"><span class="icon-stop"></span></div>\n\n    <div class="action settings" title="'+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"Settings",options):helperMissing.call(depth0,"__","Settings",options)))+'">\n        <span class="icon-settings"></span>\n        <div class="settings-menu">\n            ',!(stack1=helpers.if.call(
depth0,depth0&&depth0.allowVolumeSetting,{hash:{},inverse:this.noop,fn:this.program(1,function(depth0,helper){var options,buffer="";return buffer+='\n            <div class="option volume" title="'+escapeExpression((options={hash:{},data:helper},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"Volume",options):helperMissing.call(depth0,"__","Volume",options)))+'">\n                <span class="icon-volume"></span>\n                <div class="slider-container">\n                    <div class="slider"></div>\n                </div>\n                <div class="hover-container"></div>\n            </div>\n            '},data),data:data})
)&&0!==stack1||(buffer+=stack1),buffer+='\n            <div class="option speed" title="'+escapeExpression((options={hash:{},data:data},(helper=helpers.__||depth0&&depth0.__)?helper.call(depth0,"Speech speed",options):helperMissing.call(depth0,"__","Speech speed",options)))+'">\n                <span class="icon-speed"></span>\n                <div class="slider-container">\n                    <div class="slider"></div>\n                </div>\n                <div class="hover-container"></div>\n            </div>\n        </div>\n    </div>\n</div>'})}),define("css!taoTextHelp/runner/plugins/tools/textToSpeech/textToSpeech",[],function(){}),define(
"taoTextHelp/runner/plugins/tools/textToSpeech/textToSpeech",["jquery","lodash","i18n","core/logger","ui/component","json!taoTextHelp//runner/plugins/tools/textToSpeech/languages.json","json!taoTextHelp//runner/plugins/tools/textToSpeech/crosswalk.json","tpl!taoTextHelp/runner/plugins/tools/textToSpeech/textToSpeech","css!taoTextHelp/runner/plugins/tools/textToSpeech/textToSpeech","nouislider","mathJax"],function($,_,__,loggerFactory,componentFactory,languagesMap,languagesCrosswalk,tpl){"use strict";var logger=loggerFactory("textHelp/textToSpeech"),_defaults={setupUrl:"//configuration.speechstream.net/oat/taopremimum/v216/config.js",bookId:null,pageId:null,
maxIdLength:32,enableClickToSpeak:!1,allowVolumeSetting:!1,allowTextHelpLangCheck:!1,allowQtiLangCheck:!0,languagesCrosswalk:{},forceLanguage:!0,voiceLanguage:"en-US",voiceGender:"female",voiceIndex:0,ignoreEls:["header",".left-bar",".right-bar",".modal","footer",".action-bar",".sts-scope",".media-container"]},textHelpMapping={properties:{texthelpSpeechStream:"TexthelpSpeechStream",voiceName:"eba_voice",language:"eba_language",locale:"eba_locale",bookId:"eba_book_id",pageId:"eba_page_id",voiceFromLangFlag:"eba_voice_from_lang_flag"},functions:{barDynamicStart:"$rw_barDynamicStart",barInit:"$rw_barInit",disableSpeech:"$rw_disableSpeech",
enableClickToSpeak:"$rw_enableClickToSpeak",enableContinuousReading:"$rw_enableContinuousReading",enableSpeech:"$rw_enableSpeech",event_pause:"$rw_event_pause",event_play:"$rw_event_play",setVoice:"$rw_setVoice",onloadCallback:"eba_onload_callback",speechmodeCallback:"eba_speechmode_callback",pageCompleteCallback:"eba_page_complete_callback",speechCompleteCallback:"$rw_speechCompleteCallback",renderingSpeechCallback:"$rw_renderingSpeechCallback",setSentenceFromSelection:"$rw_setSentenceFromSelection",isPaused:"$rw_isPaused",isSpeaking:"$rw_isSpeaking",setSpeedValue:"$rw_setSpeedValue",setVolumeValue:"$rw_setVolumeValue",stopSpeech:"$rw_stopSpeech",
setBookId:"$rw_setBookId",setPageId:"$rw_setPageId",tagSentences:"$rw_tagSentences",userParameters:"$rw_userParameters",setCurrentTarget:"$rw_setCurrentTarget"}};function getTHPropName(name){return textHelpMapping.properties[name]}function getTHFuncName(name){return textHelpMapping.functions[name]}function setTHProp(name,value){return(name=getTHPropName(name))?window[name]=value:void 0}function getTHFunc(name){return(name=getTHFuncName(name))&&window[name]}function setTHFunc(name,fn){return(name=getTHFuncName(name))&&_.isFunction(fn)?window[name]=fn:void 0}return function(areaBroker,config){var component,speed,volume,onCompleteDelayer,languagesHistory=[],
crosswalk=_.clone(languagesCrosswalk);function eventifyTHFunc(method,event){var fn=getTHFunc(method);_.isFunction(fn)&&setTHFunc(method,function(){var params=[event||method],args=params.slice.call(arguments);return component.trigger.apply(component,params.concat(args)),fn.apply(this,args)})}function clearOnCompleteDelayer(){onCompleteDelayer&&(clearTimeout(onCompleteDelayer),onCompleteDelayer=null)}return component=componentFactory({exec:function(fn){fn=getTHFunc(fn);if(_.isFunction(fn))return fn.apply(this,[].slice.call(arguments,1))},formatId:function(id){return encodeURIComponent(id).replace(/[%.]+/g,"").substr(-this.config.maxIdLength)},
updateTexthelpCache:function(deliveryId,itemId){return this.config.bookId=this.formatId(deliveryId),this.config.pageId=this.formatId(itemId),setTHProp("bookId",this.config.bookId),setTHProp("pageId",this.config.pageId),this.exec("setBookId",this.config.bookId),this.exec("setPageId",this.config.pageId),this.exec("tagSentences",areaBroker.getContentArea().selector),this},enable:function(){return this.exec("enableSpeech"),this},disable:function(){return this.exec("disableSpeech"),this},play:function(){return this.exec("isSpeaking")&&!this.exec("isPaused")||(this.exec("event_play"),this.trigger("play")),this},pause:function(){return this.exec("event_pause"),
this.trigger("pause"),this},stop:function(){return this.exec("stopSpeech"),this.trigger("stop"),this},pushLanguage:function(languageCode,voiceGender,voiceIndex){return languagesHistory.push(_.pick(this.config,["voiceLanguage","voiceGender","voiceIndex"])),this.setLanguage(languageCode,voiceGender,voiceIndex),this},popLanguage:function(){var backup;return languagesHistory.length&&(backup=languagesHistory.pop(),this.setLanguage(backup.voiceLanguage,backup.voiceGender,backup.voiceIndex)),this},getLanguageCode:function(code){return code=(""+code).replace(/_/g,"-"),crosswalk[code.toLocaleLowerCase()]||code},canSetLanguage:function(){
var allowTextHelpLangCheck=this.config.allowTextHelpLangCheck;return!allowTextHelpLangCheck||allowTextHelpLangCheck&&!this.config.allowQtiLangCheck},setLanguage:function(languageCode,voiceGender,lang){lang=_.merge(this.config,_.defaults({voiceLanguage:languageCode,voiceGender:voiceGender,voiceIndex:lang},this.config)),lang=function(lang,voiceGender,voiceIndex){var voices=languagesMap[lang],lang={voice:"Ava",language:window.ENGLISH_US,locale:"US"};return voices&&(lang.language=window[voices.language]||lang.language,lang.locale=voices.locale,voices=voices.voices[voiceGender]||_.values(voices.voices)[0],lang.voice=voices[Math.max(0,Math.min(parseInt(voiceIndex,
10)||0,voices.length-1))]),lang}(this.getLanguageCode(lang.voiceLanguage),lang.voiceGender,lang.voiceIndex);return setTHProp("voiceName",lang.voice),setTHProp("language",lang.language),setTHProp("locale",lang.locale),this.exec("setVoice",lang.voice),this},setSpeed:function(value){return speed=+value,this.exec("setSpeedValue",speed),this.trigger("setSpeed",speed),this},setVolume:function(value){return volume=+value,this.exec("setVolumeValue",volume),this.trigger("setVolume",volume),this},clickToSpeak:function(){var self=this,$contentArea=areaBroker.getContentArea(),$navigationArea=areaBroker.getNavigationArea()
;return this.config.enableClickToSpeak=!this.config.enableClickToSpeak,this.exec("enableClickToSpeak",this.config.enableClickToSpeak),this.exec("enableContinuousReading",!this.config.enableClickToSpeak),this.trigger("clickToSpeak"),$contentArea.find(".qti-item").each(function(){$(this).toggleClass("prevent-click-handler")}),$navigationArea.off("click.tts").on("click.tts","a",function(){0<$contentArea.find(".qti-item.prevent-click-handler").length&&self.clickToSpeak()}),this}},_defaults).setTemplate(tpl).on("init",function(){var self=this,cfg=this.config;volume=speed=40,_.merge(crosswalk,cfg.languagesCrosswalk),$(this.config.ignoreEls.join(",")).attr(
"data-ignore",!0),require([cfg.setupUrl],function(){var name,fn=getTHFunc("userParameters"),tss=(name=getTHPropName(name="texthelpSpeechStream"))&&window[name];setTHFunc("userParameters",function(){var res;_.isFunction(fn)&&(res=fn.apply(this,[].slice.call(arguments)));try{setTHProp("voiceFromLangFlag",!self.canSetLanguage()),cfg.forceLanguage&&self.setLanguage(cfg.voiceLanguage,cfg.voiceGender,cfg.voiceIndex),setTHProp("bookId",self.formatId(cfg.bookId)),setTHProp("pageId",self.formatId(cfg.pageId)),setTHFunc("pageCompleteCallback",function(){self.trigger("stop")}),setTHFunc("speechmodeCallback",function(speaking){self.trigger("speechmode",speaking)}),
setTHFunc("onloadCallback",function(){self.trigger("load")}),self.exec("enableClickToSpeak",self.config.enableClickToSpeak),self.exec("setSpeedValue",speed),self.exec("setVolumeValue",volume),eventifyTHFunc("speechCompleteCallback","speechComplete"),eventifyTHFunc("renderingSpeechCallback","renderingSpeech"),eventifyTHFunc("setSentenceFromSelection","setSentence")}catch(err){logger.error(err)}return res});try{tss.addToolbar(self.formatId(cfg.bookId),self.formatId(cfg.pageId))}catch(err){logger.error(err)}})}).init(config).on("render",function(){var self=this,$this=this.getElement();$this.on("mousedown",function(e){return e.preventDefault(),!1}),$this.find(
".action").on("click",function(e){var $action=$(this);$action.hasClass("disabled")&&e.stopImmediatePropagation(),$action.closest(".settings").length||($this.find(".settings").removeClass("active"),$this.find(".settings > .settings-menu").hide())}),$this.find(".settings").on("click",function(){$(this).toggleClass("active"),$this.find(".settings-menu").toggle()}),$this.find(".settings > .settings-menu").on("click",function(e){e.stopPropagation()}).hide(),$this.find(".settings > .settings-menu > .option").on("mouseenter",function(){$(this).find(".slider-container").show()}).on("mouseleave",function(){$(this).find(".slider-container").hide()}),$this.find(
".settings > .settings-menu > .option > .slider-container").hide(),$this.find(".click-to-speak").on("click",function(){self.clickToSpeak()}),$this.find(".play").on("click",function(){self.play()}),$this.find(".pause").on("click",function(){self.pause()}).hide(),$this.find(".stop").on("click",function(){self.stop()}),self.config.allowVolumeSetting&&$this.find(".settings > .settings-menu > .volume .slider").noUiSlider({animate:!0,connected:!0,range:{min:0,max:100},start:volume,step:10}).on("change",function(e,value){self.setVolume(value)}),$this.find(".settings > .settings-menu > .speed .slider").noUiSlider({animate:!0,connected:!0,range:{min:25,max:55},
start:speed,step:15}).on("change",function(e,value){self.setSpeed(value)})}).on("clickToSpeak",function(){var $el=this.getElement(),$contentArea=areaBroker.getContentArea();this.config.enableClickToSpeak?($el.find(".click-to-speak").addClass("active"),$el.find(".play").addClass("disabled").show(),$el.find(".pause").addClass("disabled").hide(),$contentArea.css("cursor","pointer")):($el.find(".click-to-speak").removeClass("active"),$el.find(".play").removeClass("disabled").show(),$el.find(".pause").removeClass("disabled").hide(),$contentArea.css("cursor","default"))}).on("play",function(){var $el=this.getElement();$el.find(".play").hide(),$el.find(".pause"
).show()}).on("pause",function(){var $el=this.getElement();$el.find(".play").show(),$el.find(".pause").hide()}).on("stop",function(){var $el=this.getElement();$el.find(".play").show(),$el.find(".pause").hide()}).on("setSentence renderingSpeech",function(){clearOnCompleteDelayer(),this.trigger("play")}).on("speechComplete",function(source){var self=this;"Complete"===source&&(clearOnCompleteDelayer(),onCompleteDelayer=setTimeout(function(){self.trigger("stop")},200))})}}),define("taoTextHelp/runner/plugins/tools/textToSpeech/plugin",["jquery","lodash","i18n","ui/hider","ui/stacker","taoTests/runner/plugin","taoQtiTest/runner/helpers/map",
"taoTextHelp/runner/plugins/tools/textToSpeech/textToSpeech"],function($,_,__,hider,stackerFactory,pluginFactory,mapHelper,ttsFactory){"use strict";var mathAriaEls=['[data-qti-class="math"]',".math-renderer"],mathWrapEls=[".math-entry"];return pluginFactory({name:"textToSpeech",init:function(){var self=this,testRunner=this.getTestRunner();this.ttsButton=this.getAreaBroker().getToolbox().createEntry({control:"tts",icon:"headphones",text:__("Text to Speech"),title:__("Text to Speech")}).on("render",function(){var stacker=stackerFactory("test-runner");self.tts=ttsFactory(testRunner.getAreaBroker(),self.getConfig()).render(self.ttsButton.getElement()).disable(
).hide(),stacker.autoBringToFront(self.tts.getElement())}).on("click",function(e){var ttsEl=self.tts.getElement();$(e.target).closest(ttsEl).length||(hider.toggle(ttsEl),ttsEl.hasClass("hidden")?self.tts.disable():self.tts.enable())}).disable().hide(),testRunner.on("loaditem",function(){self.disable(),self.ttsButton.hide(),self.ttsButton.$component.find(".settings").removeClass("active"),self.ttsButton.$component.find(".settings > .settings-menu").hide()}).on("enabletools",function(){self.enable()}).on("renderitem",function(){var languageCode,deliveryId,itemId=testRunner.getTestContext(),$qti=testRunner.getTestMap(),config=testRunner.getConfig(),
item=mapHelper.getItem($qti,itemId.itemIdentifier),ttsConfig=self.getConfig()||{},$qti=testRunner.getAreaBroker().getContentArea();itemId.options.textToSpeech&&(self.enable(),self.ttsButton.show(),$qti.find("img").each(function(){!this.getAttribute("data-msg")&&this.hasAttribute("alt")&&this.setAttribute("data-msg",this.getAttribute("alt"))}),ttsConfig.overrideMathExpr&&_.isString(ttsConfig.overrideMathExpr)&&($qti.find(mathAriaEls.join(",")).each(function(){this.setAttribute("role","math"),this.setAttribute("aria-label",ttsConfig.overrideMathExpr)}),$qti.find(mathWrapEls.join(",")).wrap($("<span />").attr("data-pron",ttsConfig.overrideMathExpr))),
self.tts.config.allowQtiLangCheck&&($qti=$qti.find(".qti-item"),(languageCode=$qti.attr("lang"))?$qti.attr("lang",self.tts.getLanguageCode(languageCode)):(languageCode=$qti.attr("xml:lang"))&&$qti.attr("xml:lang",self.tts.getLanguageCode(languageCode))),self.tts.canSetLanguage()&&(_.forEach(item.categories,function(category){if("x-tao-lang-"===category.substr(0,"x-tao-lang-".length))return languageCode=category.substr("x-tao-lang-".length),!1}),languageCode&&self.tts.pushLanguage(languageCode)),itemId=ttsConfig.tenantName?(deliveryId=ttsConfig.tenantName,this.itemRunner._item.attributes.identifier):(deliveryId=config.testDefinition,itemId.itemIdentifier),
self.tts.updateTexthelpCache(deliveryId,itemId))}).on("unloaditem",function(){void 0!==self.tts&&self.tts.popLanguage()}).on("disabletools unloaditem",function(){var context=testRunner.getTestContext();context.options&&context.options.textToSpeech&&void 0!==self.tts&&(self.tts.stop(),self.tts.exec("setCurrentTarget",null)),self.disable()})},enable:function(){this.tts&&this.tts.enable(),this.ttsButton&&this.ttsButton.enable()},disable:function(){this.tts&&this.tts.disable(),this.ttsButton&&this.ttsButton.disable()}})}),function(c){var d=document,a="appendChild",i="styleSheet",s=d.createElement("style");s.type="text/css",d.getElementsByTagName("head")[0][a](s)
,s[i]?s[i].cssText=c:s[a](d.createTextNode(c))}(
".text-to-speech{border:1px solid #ddd;border-radius:2px;-webkit-border-radius:2px;background-color:#f3f1ef;bottom:37px;box-shadow:0 0 15px 1px rgba(0,0,0,0.2);color:#222;left:-2px;padding:2px;position:absolute;width:146px}.text-to-speech>.action{background-color:#f3f1ef;display:inline-block;height:28px;position:relative;width:32px}.text-to-speech>.action>span{color:#222;font-size:15px !important;padding:0 !important;vertical-align:middle;left:0}.text-to-speech>.action>.settings-menu{border:1px solid #ddd;border-radius:2px;-webkit-border-radius:2px;background-color:#f3f1ef;bottom:30px;box-shadow:0 0 15px 1px rgba(0,0,0,0.2);left:-1px;padding:2px;position:absolute}.text-to-speech>.action>.settings-menu>.option{background-color:#f3f1ef;height:30px;position:relative;width:30px}.text-to-speech>.action>.settings-menu>.option>span{color:#222;font-size:15px;padding:0;vertical-align:middle;left:0}.text-to-speech>.action>.settings-menu>.option>span.icon-volume{left:1px}.text-to-speech>.action>.settings-menu>.option>.slider-container{border:1px solid #ddd;border-radius:2px;-webkit-border-radius:2px;background-color:#f3f1ef;height:12px;left:26px;margin:8px;padding:2px;position:relative;top:-22px;width:80px}.text-to-speech>.action>.settings-menu>.option>.slider-container .noUi-horizontal{height:6px}.text-to-speech>.action>.settings-menu>.option>.slider-container .noUi-horizontal .noUi-handle{top:-7px}.text-to-speech>.action>.settings-menu>.option>.hover-container{height:44px;left:20px;position:absolute;top:-8px;width:106px;z-index:-1}.text-to-speech>.action>.settings-menu>.option:hover{background-color:#f3f1ef}.text-to-speech>.action>.settings-menu>.option:hover>span{color:#9c9c9c}.text-to-speech>.action:hover{background-color:#f3f1ef}.text-to-speech>.action:hover>span{color:#9c9c9c}.text-to-speech>.action.active{background-color:#a4a9b1}.text-to-speech>.action.active>span{color:#4e4e4e}.text-to-speech>.action.disabled{background-color:#f3f1ef !important}.text-to-speech>.action.disabled>span{color:#d3d3d3}\n\n/*# sourceMappingURL=taoTextHelp/runner/plugins/tools/textToSpeech/textToSpeech.css.map */"
),define("taoTextHelp/loader/testPlugins.bundle",function(){});
//# sourceMappingURL=testPlugins.min.js.map